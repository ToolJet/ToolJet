{
  "$schema": "https://raw.githubusercontent.com/ToolJet/ToolJet/develop/plugins/schemas/manifest.schema.json",
  "title": "Mssql datasource",
  "description": "A schema defining mssql datasource",
  "type": "object",
  "tj:version": "1.0.0",
  "tj:source": {
    "name": "SQL Server",
    "kind": "mssql",
    "type": "database"
  },
  "properties": {
    "host": {
      "type": "string",
      "title": "Host",
      "description": "Enter host",
      "default": "localhost"
    },
    "instanceName": {
      "type": "string",
      "title": "Instance",
      "description": "Enter the name of the database instance"
    },
    "port": {
      "type": "number",
      "title": "Port",
      "description": "Enter port",
      "default": 1433
    },
    "database": {
      "type": "string",
      "title": "Database name",
      "description": "Enter name of the database"
    },
    "username": {
      "type": "string",
      "title": "Username",
      "description": "Enter username"
    },
    "password": {
      "type": "string",
      "title": "Password",
      "description": "Enter password"
    },
    "connection_options": {
      "type": "array",
      "title": "Connection options",
      "description": "Connection options"
    },
    "azure": {
      "type": "boolean",
      "title": "Azure (encrypt connection)",
      "description": "Toggle for azure",
      "default": false
    },
    "ssh_enabled": {
      "type": "string",
      "title": "SSH Tunnel",
      "description": "Connect through an SSH server",
      "enum": ["enabled", "disabled"],
      "default": "disabled"
    },
    "ssh_host": {
      "type": "string",
      "title": "SSH Host"
    },
    "ssh_port": {
      "type": "number",
      "title": "SSH Port",
      "default": 22
    },
    "ssh_username": {
      "type": "string",
      "title": "SSH Username"
    },
    "ssh_auth_type": {
      "type": "string",
      "title": "Authentication Type",
      "enum": ["key", "password"],
      "default": "key"
    },
    "ssh_private_key": {
      "type": "string",
      "title": "Private key"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "ssh_enabled": {
            "const": "enabled"
          }
        }
      },
      "then": {
        "required": ["ssh_host", "ssh_port", "ssh_username", "ssh_private_key"]
      }
    }
  ],
  "tj:encrypted": [
    "password",
    "ssh_private_key"
  ],
  "required": [
    "host",
    "port",
    "database",
    "username",
    "password"
  ],
  "tj:ui:properties": {
    "host": {
      "order": 10,
      "$ref": "#/properties/host",
      "key": "host",
      "label": "Host",
      "description": "Enter host",
      "widget": "text-v3",
      "required": true
    },
    "instanceName": {
      "order": 30,
      "$ref": "#/properties/instanceName",
      "key": "instance_name",
      "label": "Instance",
      "description": "Enter the name of the database instance",
      "widget": "text"
    },
    "port": {
      "order": 20,
      "$ref": "#/properties/port",
      "key": "port",
      "label": "Port",
      "description": "Enter port",
      "widget": "text-v3",
      "required": true
    },
    "database": {
      "order": 40,
      "$ref": "#/properties/database",
      "key": "database",
      "label": "Database name",
      "description": "Enter name of the database",
      "widget": "text-v3",
      "required": true
    },
    "username": {
      "order": 50,
      "$ref": "#/properties/username",
      "key": "username",
      "label": "Username",
      "description": "Enter username",
      "widget": "text-v3",
      "required": true
    },
    "password": {
      "order": 60,
      "$ref": "#/properties/password",
      "key": "password",
      "label": "Password",
      "description": "Enter password",
      "widget": "password-v3",
      "required": true
    },
    "connection_options": {
      "order": 70,
      "$ref": "#/properties/connection_options",
      "key": "connection_options",
      "label": "Connection options",
      "widget": "react-component-headers"
    },
    "azure": {
      "order": 80,
      "$ref": "#/properties/azure",
      "key": "azure",
      "label": "Azure (encrypt connection)",
      "description": "Toggle for azure",
      "widget": "toggle"
    },
    "ssh_enabled": {
    "order": 90,
    "$ref": "#/properties/ssh_enabled",
    "key": "ssh_enabled",
    "label": "SSH Tunnel",
    "description": "Connect through an SSH server",
    "widget": "dropdown-component-flip",
    "default": false,
    "list": [
      {
        "value": "disabled",
        "name": "Disabled"
      },
      {
        "value": "enabled",
        "name": "Enabled"
      }
    ],
    "commonFields": {
      "host": {
        "order": 10,
        "$ref": "#/properties/host",
        "key": "host",
        "label": "Host",
        "description": "Enter host",
        "widget": "text-v3",
        "required": true
      },
      "instanceName": {
        "order": 30,
        "$ref": "#/properties/instanceName",
        "key": "instance_name",
        "label": "Instance",
        "description": "Enter the name of the database instance",
        "widget": "text"
      },
      "port": {
        "order": 20,
        "$ref": "#/properties/port",
        "key": "port",
        "label": "Port",
        "description": "Enter port",
        "widget": "text-v3",
        "required": true
      },
      "database": {
        "order": 40,
        "$ref": "#/properties/database",
        "key": "database",
        "label": "Database name",
        "description": "Enter name of the database",
        "widget": "text-v3",
        "required": true
      },
      "username": {
        "order": 50,
        "$ref": "#/properties/username",
        "key": "username",
        "label": "Username",
        "description": "Enter username",
        "widget": "text-v3",
        "required": true
      },
      "password": {
        "order": 60,
        "$ref": "#/properties/password",
        "key": "password",
        "label": "Password",
        "description": "Enter password",
        "widget": "password-v3",
        "required": true
      },
      "connection_options": {
        "order": 70,
        "$ref": "#/properties/connection_options",
        "key": "connection_options",
        "label": "Connection options",
        "widget": "react-component-headers"
      },
      "azure": {
        "order": 80,
        "$ref": "#/properties/azure",
        "key": "azure",
        "label": "Azure (encrypt connection)",
        "description": "Toggle for azure",
        "widget": "toggle"
      }
    }
  },
  "enabled": {
    "ssh_host": {
      "order": 100,
      "$ref": "#/properties/ssh_host",
      "key": "ssh_host",
      "label": "SSH Host",
      "description": "SSH server hostname or IP address",
      "widget": "text-v3"
    },
    "ssh_port": {
      "order": 110,
      "$ref": "#/properties/ssh_port",
      "key": "ssh_port",
      "label": "SSH Port",
      "description": "Default SSH port is 22",
      "widget": "text-v3"
    },
    "ssh_username": {
      "order": 120,
      "$ref": "#/properties/ssh_username",
      "key": "ssh_username",
      "label": "SSH Username",
      "description": "SSH Username",
      "widget": "text-v3"
    },
    "ssh_auth_type": {
      "order": 125,
      "$ref": "#/properties/ssh_auth_type",
      "key": "ssh_auth_type",
      "label": "Authentication Type",
      "description": "SSH authentication method",
      "widget": "dropdown"
    },
    "ssh_private_key": {
      "order": 130,
      "$ref": "#/properties/ssh_private_key",
      "key": "ssh_private_key",
      "label": "Private key",
      "description": "SSH private key",
      "widget": "password-v3"
    }
  },
  "disabled": {}    
  }
}
