{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "version": "1.0.1",
  "title": "Postgresql datasource",
  "description": "A schema defining postgresql datasource",
  "type": "object",
  "source": {
    "name": "PostgreSQL",
    "kind": "postgresql",
    "options": {
      "host": {
        "type": "string"
      },
      "port": {
        "type": "string"
      },
      "database": {
        "type": "string"
      },
      "username": {
        "type": "string"
      },
      "password": {
        "type": "string",
        "encrypted": true
      },
      "ca_cert": {
        "encrypted": true
      },
      "client_key": {
        "encrypted": true
      },
      "client_cert": {
        "encrypted": true
      },
      "root_cert": {
        "encrypted": true
      },
      "connection_options": {
        "type": "array"
      },
      "connection_string": {
        "type": "string",
        "encrypted": true
      }
    },
    "exposedVariables": {
      "isLoading": false,
      "data": {},
      "rawData": {}
    }
  },
  "properties": {
    "connection_type": {
      "type": "string",
      "title": "Connection type",
      "ui_widget": "dropdown-component-flip",
      "description": "Single select dropdown for connection_type",
      "enum": [
        "manual",
        "string"
      ],
      "enumNames": [
        "Manual connection",
        "Connection string"
      ],
      "default": "manual"
    },
    "host": {
      "type": "string",
      "title": "Host",
      "ui_widget": "text-v3",
      "description": "Enter host",
      "default": "localhost"
    },
    "port": {
      "type": "number",
      "title": "Port",
      "ui_widget": "text-v3",
      "description": "Enter port",
      "default": 5432
    },
    "database": {
      "type": "string",
      "title": "Database name",
      "ui_widget": "text-v3",
      "description": "Name of the database"
    },
    "username": {
      "type": "string",
      "title": "Username",
      "ui_widget": "text-v3",
      "description": "Enter username"
    },
    "password": {
      "type": "string",
      "title": "Password",
      "ui_widget": "password-v3",
      "description": "Enter password",
      "encrypted": true
    },
    "connection_options": {
      "type": "string",
      "title": "Connection options",
      "ui_widget": "react-component-headers",
      "width": "316px",
      "optional": true
    },
    "ssl_enabled": {
      "type": "boolean",
      "title": "SSL",
      "ui_widget": "toggle",
      "description": "Toggle for ssl_enabled",
      "default": true
    },
    "ssl_certificate": {
      "type": "string",
      "title": "SSL certificate",
      "ui_widget": "dropdown-component-flip",
      "description": "Single select dropdown for choosing certificates",
      "enum": [
        "ca_certificate",
        "self_signed",
        "none"
      ],
      "enumNames": [
        "CA certificate",
        "Self-signed certificate",
        "None"
      ],
      "default":"none",
      "optional": true
    },
    "connection_string": {
      "type": "string",
      "title": "Connection string",
      "ui_widget": "text",
      "encrypted": true,
      "description": "postgres://username:password@hostname:port/database?sslmode=require"
    },
    "ca_cert": {
      "type": "string",
      "title": "CA Cert",
      "ui_widget": "textarea",
      "encrypted": true,
      "description": "Enter ca certificate"
    },
    "client_key": {
      "type": "string",
      "title": "Client Key",
      "ui_widget": "textarea",
      "encrypted": true,
      "description": "Enter client key"
    },
    "client_cert": {
      "type": "string",
      "title": "Client Cert",
      "ui_widget": "textarea",
      "encrypted": true,
      "description": "Enter client certificate"
    },
    "root_cert": {
      "type": "string",
      "title": "Root Cert",
      "ui_widget": "textarea",
      "encrypted": true,
      "description": "Enter root certificate"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "connection_type": {
            "const": "manual"
          }
        }
      },
      "then": {
        "required": [
          "host",
          "port",
          "database",
          "username",
          "password",
          "connection_options",
          "ssl_enabled",
          "ssl_certificate"
        ],
        "allOf": [
          {
            "if": {
              "properties": {
                "ssl_certificate": {
                  "const": "ca_certificate"
                }
              }
            },
            "then": {
              "required": [
                "ca_cert"
              ]
            }
          },
          {
            "if": {
              "properties": {
                "ssl_certificate": {
                  "const": "self_signed"
                }
              }
            },
            "then": {
              "required": [
                "client_key",
                "client_cert",
                "root_cert"
              ]
            }
          }
        ]
      }
    },
    {
      "if": {
        "properties": {
          "connection_type": {
            "const": "string"
          }
        }
      },
      "then": {
        "required": [
          "connection_string"
        ]
      }
    }
  ],
  "required": [
    "connection_type"
  ]
}