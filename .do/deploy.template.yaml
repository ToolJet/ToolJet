spec:
  name: tooljet
  services:
  - name: tooljet
    image: 
      registry_type: DOCKER_HUB
      registry: tooljet
      repository: tooljet
      tag: EE-LTS-latest
    run_command: "./server/scripts/digitalocean-postbuild.sh"
    instance_size_slug: "basic-s"
    health_check:
      initial_delay_seconds: 10
      http_path: /api/health
    envs:
    - key: NODE_ENV
      value: "production"  # Environment set to production
    - key: NODE_OPTIONS
      value: "--max-old-space-size=4096"  # Memory allocation for Node.js
    - key: LOCKBOX_MASTER_KEY
      type: SECRET
      value: "actual-lockbox-master-key-1234"  # Replace with actual secure value
    - key: SECRET_KEY_BASE
      value: "actual-secret-key-base-5678"  # Replace with actual secure value
      type: SECRET
    - key: DISABLE_SIGNUPS
      value: "false"  # Control user signups (true/false)
      scope: RUN_TIME
    - key: DEPLOYMENT_PLATFORM
      value: "digitalocean"  # Deployment platform specified
    - key: DATABASE_URL
      scope: RUN_TIME
      value: ${pg-db.DATABASE_URL}  # Injected at runtime
    - key: CA_CERT
      scope: RUN_TIME
      value: ${pg-db.CA_CERT}  # Injected at runtime
    - key: TOOLJET_HOST
      scope: RUN_TIME
      value: ${APP_URL}  # Injected at runtime
    - key: TOOLJET_SERVER_URL
      scope: RUN_TIME
      value: ${APP_URL}  # Injected at runtime
  databases:
    - name: pg-db
      engine: PG
      production: true  # Set to true for production
